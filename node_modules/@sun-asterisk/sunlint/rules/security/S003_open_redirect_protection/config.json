{
  "ruleId": "S003",
  "name": "Open Redirect Protection",
  "description": "URL redirects must validate against an allow list to prevent open redirect vulnerabilities",
  "category": "security",
  "severity": "warning",
  "languages": ["All languages"],
  "tags": [
    "security",
    "owasp",
    "injection",
    "open-redirect",
    "phishing",
    "url-validation"
  ],
  "enabled": true,
  "fixable": false,
  "engine": "heuristic",
  "metadata": {
    "owaspCategory": "A03:2021 - Injection",
    "cweId": "CWE-601",
    "description": "Applications that redirect users to URLs from untrusted input without validation are vulnerable to phishing attacks. Attackers can create legitimate-looking links that redirect victims to malicious sites.",
    "impact": "Medium - Phishing attacks, credential theft, malware distribution",
    "likelihood": "High",
    "remediation": "Use allow list (whitelist) to validate redirect URLs, or only allow relative URLs within the same domain"
  },
  "patterns": {
    "vulnerable": [
      "res.redirect(req.query.*) without validation",
      "res.redirect(req.params.*) without validation",
      "window.location = userInput without validation",
      "response.sendRedirect(request.getParameter(*)) without validation",
      "new RedirectView(userInput) without validation",
      "res.setHeader('Location', req.query.*) without validation"
    ],
    "secure": [
      "Validate against allow list (whitelist) of trusted domains",
      "Only allow relative URLs (startsWith('/') && !startsWith('//'))",
      "Use indirect mapping (key -> URL mapping)",
      "Parse and validate URL with new URL() and check hostname",
      "Use framework validation (e.g., @IsIn(['home', 'dashboard']))"
    ]
  },
  "examples": {
    "violations": [
      "res.redirect(req.query.url);",
      "window.location.href = params.get('redirect');",
      "response.sendRedirect(request.getParameter('next'));",
      "new RedirectView(request.getParameter('url'));"
    ],
    "fixes": [
      "const url = req.query.url; if (ALLOWED_URLS.includes(url)) res.redirect(url);",
      "if (isAllowedDomain(url)) window.location.href = url;",
      "const destination = REDIRECT_MAP[req.query.key]; res.redirect(destination);",
      "if (url.startsWith('/') && !url.startsWith('//')) res.redirect(url);"
    ]
  }
}
