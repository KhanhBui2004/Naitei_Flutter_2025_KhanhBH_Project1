# Rule S054 - Disallow Default/Built-in Accounts

## Mục tiêu
Ngăn chặn tấn công brute-force và đảm bảo tính truy vết, minh bạch trong kiểm toán. Tránh các tài khoản dễ đoán và dùng chung không rõ danh tính.

## Chi tiết
- Không sử dụng tài khoản mặc định hoặc tài khoản có tên phổ biến (admin, root, sa, test, guest, ...)
- Mỗi người dùng phải có tài khoản riêng biệt với quyền hạn được giới hạn theo vai trò
- Bắt buộc đổi mật khẩu mặc định khi khởi tạo hệ thống hoặc khi user được tạo mới
- Hệ thống cần log mọi lần đăng nhập và truy cập tài nguyên theo từng user cụ thể

## Phạm vi kiểm tra

### 1. SQL/Seeder/Migration
- `INSERT INTO users/accounts` with blocked usernames
- `CREATE USER` statements  
- `GRANT/REVOKE` permissions to default accounts

### 2. Code/Application
- `createUser()`, `new User()`, `addUser()` with blocked usernames
- User registration/creation functions
- Authentication/authorization code

### 3. Infrastructure as Code (IaC)
- **Terraform**: `username = "admin"`, `user = "root"`
- **Helm/Values**: `adminUser:`, `defaultPass:`
- **Docker/Compose**: `POSTGRES_USER=postgres`, `ENV USER=admin`
- **Kubernetes**: `serviceAccount: default`, `user: admin`

### 4. Configuration Files
- Database configs: `db.username=admin`
- Application configs: `auth.user=root` 
- Environment files: `.env` with default credentials

### 5. Documentation
- README/docs with exposed default credentials
- Login examples with real default accounts

## Blocked Usernames
```
admin, root, sa, test, guest, operator, super, superuser, sys,
postgres, mysql, mssql, oracle, elastic, kibana, grafana,
administrator, demo, example, default, public, anonymous,
user, password, service, support, backup, monitor
```

## Password Smells
```
password, 123456, admin, Admin@123, Password1, changeme,
default, qwerty, letmein, welcome, secret, pass123,
root, toor, administrator, guest
```

## Exemptions
- Test directories: `test/`, `tests/`, `__tests__/`, `e2e/`, `spec/`
- Mock/fixture data
- Documentation examples (with warnings)

## Examples

### ❌ Violations

**SQL:**
```sql
INSERT INTO users (username, password) VALUES ('admin', 'password123');
CREATE USER 'root'@'localhost' IDENTIFIED BY 'admin';
```

**Code:**
```javascript
createUser({ username: 'admin', password: 'default' });
const user = new User('test', 'password');
```

**Terraform:**
```hcl
username = "admin"
admin_username = "root"
```

**Docker:**
```dockerfile
ENV POSTGRES_USER=postgres
ENV MYSQL_USER=root
```

**Config:**
```properties
spring.datasource.username=admin
db.username=root
```

### ✅ Correct Usage

**SQL:**
```sql
INSERT INTO users (username, password) VALUES ('john.doe', '${HASHED_PASSWORD}');
CREATE USER '${DB_USERNAME}'@'localhost' IDENTIFIED BY '${DB_PASSWORD}';
```

**Code:**
```javascript
createUser({ username: userInput.username, password: hashedPassword });
const user = new User(registrationForm.username, securePassword);
```

**Terraform:**
```hcl
username = var.database_username
admin_username = var.admin_user
```

**Docker:**
```dockerfile
ENV POSTGRES_USER=${DB_USERNAME}
ENV MYSQL_USER=${DATABASE_USER}
```

## Policy Requirements
- ✅ `requirePerUserAccount`: true
- ✅ `requireInitialPasswordChange`: true  
- ✅ `forbidWellKnownServiceAccountsInAppDB`: true
- ✅ `allowOnlyInEphemeralTests`: true
- ✅ `mustDisableBuiltInsOnInfra`: true

## Thresholds
- Production: `maxFindings = 0`
- Test paths: `maxInAllowedPaths = 2`
- Password smells: `maxPasswordSmells = 0`