# S014 - Enforce TLS 1.2 or 1.3 Only

## üìã Overview

**Rule ID:** S014  
**Category:** Security  
**Severity:** Error  
**Enabled:** Yes

Ensures that only secure TLS versions (1.2 or 1.3) are used in HTTPS server configurations and client connections. Detects usage of insecure SSL/TLS versions (SSLv2, SSLv3, TLS 1.0, TLS 1.1) which have known vulnerabilities.

---

## üéØ Detection Scope

### Insecure TLS/SSL Versions ‚ùå

| Version     | Status      | Reason                                          |
| ----------- | ----------- | ----------------------------------------------- |
| **SSLv2**   | ‚ùå Insecure | Deprecated (RFC 6176), multiple vulnerabilities |
| **SSLv3**   | ‚ùå Insecure | POODLE attack (CVE-2014-3566)                   |
| **TLS 1.0** | ‚ùå Insecure | BEAST attack, deprecated by PCI DSS             |
| **TLS 1.1** | ‚ùå Insecure | Weak ciphers, deprecated by major browsers      |

### Secure TLS Versions ‚úÖ

| Version     | Status    | Recommendation              |
| ----------- | --------- | --------------------------- |
| **TLS 1.2** | ‚úÖ Secure | Minimum recommended version |
| **TLS 1.3** | ‚úÖ Secure | Latest, most secure version |

---

## üîç What This Rule Detects

### 1. HTTPS Server Configuration

```typescript
// ‚ùå BAD: Using TLS 1.0
https.createServer(
  {
    minVersion: "TLSv1", // Insecure!
    cert: cert,
    key: key,
  },
  app
);

// ‚úÖ GOOD: Using TLS 1.2+
https.createServer(
  {
    minVersion: "TLSv1.2", // Secure
    cert: cert,
    key: key,
  },
  app
);
```

### 2. Secure Protocol Settings

```typescript
// ‚ùå BAD: Using SSLv3
const options = {
  secureProtocol: "SSLv3_method", // Insecure!
};

// ‚úÖ GOOD: Using TLS 1.2
const options = {
  secureProtocol: "TLSv1_2_method", // Secure
};
```

### 3. Client Configuration

```typescript
// ‚ùå BAD: axios with TLS 1.0
const agent = new https.Agent({
  minVersion: "TLSv1", // Insecure!
});

// ‚úÖ GOOD: axios with TLS 1.2+
const agent = new https.Agent({
  minVersion: "TLSv1.2", // Secure
});
```

### 4. Framework-Specific Configuration

#### Express.js

```typescript
// ‚ùå BAD
const server = https.createServer(
  {
    secureProtocol: "TLSv1_method", // Insecure!
  },
  app
);

// ‚úÖ GOOD
const server = https.createServer(
  {
    minVersion: "TLSv1.2", // Secure
  },
  app
);
```

#### Next.js (next.config.js)

```javascript
// ‚ùå BAD
module.exports = {
  server: {
    https: {
      minVersion: "TLSv1.0", // Insecure!
    },
  },
};

// ‚úÖ GOOD
module.exports = {
  server: {
    https: {
      minVersion: "TLSv1.2", // Secure
    },
  },
};
```

#### NestJS

```typescript
// ‚ùå BAD
const httpsOptions = {
  secureProtocol: "SSLv3_method", // Insecure!
};

// ‚úÖ GOOD
const httpsOptions = {
  minVersion: "TLSv1.2", // Secure
};
```

---

## üö® Security Impact

### Critical Vulnerabilities

| Attack         | Affected Versions | CVE           |
| -------------- | ----------------- | ------------- |
| **POODLE**     | SSLv3             | CVE-2014-3566 |
| **BEAST**      | TLS 1.0           | CVE-2011-3389 |
| **CRIME**      | TLS 1.0/1.1       | CVE-2012-4929 |
| **BREACH**     | TLS 1.0/1.1       | CVE-2013-3587 |
| **Heartbleed** | TLS 1.0/1.1       | CVE-2014-0160 |

### Compliance Requirements

- ‚úÖ **PCI DSS 3.2+:** Requires TLS 1.2+ (TLS 1.0/1.1 banned)
- ‚úÖ **NIST SP 800-52:** Recommends TLS 1.2+ only
- ‚úÖ **HIPAA:** Requires strong encryption (TLS 1.2+)
- ‚úÖ **GDPR:** Requires appropriate security measures

---

## üìù Examples

### Server Configuration

#### ‚ùå Violations

```typescript
// Violation 1: SSLv3
const server = https.createServer(
  {
    secureProtocol: "SSLv3_method",
  },
  app
);

// Violation 2: TLS 1.0
const options = {
  minVersion: "TLSv1",
};

// Violation 3: TLS 1.1
https.createServer(
  {
    maxVersion: "TLSv1.1",
  },
  app
);

// Violation 4: String version
const config = {
  protocol: "TLSv1.0",
};
```

#### ‚úÖ Compliant Code

```typescript
// Good: TLS 1.2
const server = https.createServer(
  {
    minVersion: "TLSv1.2",
    maxVersion: "TLSv1.3",
  },
  app
);

// Good: TLS 1.3
const options = {
  secureProtocol: "TLSv1_3_method",
};

// Good: Modern defaults
https.createServer(
  {
    minVersion: "TLSv1.2",
  },
  app
);
```

### Client Configuration

#### ‚ùå Violations

```typescript
// Violation: axios with TLS 1.0
const httpsAgent = new https.Agent({
  minVersion: "TLSv1",
});

axios.get("https://api.example.com", {
  httpsAgent,
});

// Violation: fetch with insecure agent
const agent = new https.Agent({
  secureProtocol: "TLSv1_method",
});
```

#### ‚úÖ Compliant Code

```typescript
// Good: axios with TLS 1.2+
const httpsAgent = new https.Agent({
  minVersion: "TLSv1.2",
});

axios.get("https://api.example.com", {
  httpsAgent,
});

// Good: Modern TLS
const agent = new https.Agent({
  minVersion: "TLSv1.2",
  maxVersion: "TLSv1.3",
});
```

---

## üîß How to Fix

### 1. Update Server Configuration

```typescript
// Before
const server = https.createServer(
  {
    minVersion: "TLSv1", // ‚ùå
  },
  app
);

// After
const server = https.createServer(
  {
    minVersion: "TLSv1.2", // ‚úÖ
  },
  app
);
```

### 2. Update Client Agents

```typescript
// Before
const agent = new https.Agent({
  secureProtocol: "TLSv1_method", // ‚ùå
});

// After
const agent = new https.Agent({
  minVersion: "TLSv1.2", // ‚úÖ
});
```

### 3. Framework Configuration

```typescript
// Before
const httpsOptions = {
  secureProtocol: "SSLv3_method", // ‚ùå
};

// After
const httpsOptions = {
  minVersion: "TLSv1.2", // ‚úÖ
  maxVersion: "TLSv1.3",
};
```

---

## ‚öôÔ∏è Configuration

### Pattern Detection

- `minVersion: 'TLSv1'` - Detects minimum version settings
- `maxVersion: 'TLSv1.1'` - Detects maximum version restrictions
- `secureProtocol: 'SSLv3_method'` - Detects protocol methods
- `protocol: 'TLSv1.0'` - Detects string protocols

### Supported Frameworks

- Express.js
- Next.js
- NestJS
- Nuxt.js
- Fastify
- Koa

---

## üìö References

- [RFC 8996 - Deprecating TLS 1.0 and 1.1](https://datatracker.ietf.org/doc/html/rfc8996)
- [PCI DSS Requirements](https://www.pcisecuritystandards.org/)
- [NIST SP 800-52 Rev. 2](https://csrc.nist.gov/publications/detail/sp/800-52/rev-2/final)
- [OWASP Transport Layer Protection Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Transport_Layer_Protection_Cheat_Sheet.html)

---

**Created:** October 10, 2025  
**Version:** 1.0.0  
**Status:** Active
